function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function t(e){return typeof e}:function n(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var PhotoSphereViewer=function PhotoSphereViewer(e){var t=function t(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},h=function h(){var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl"))},s=function s(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},i=function i(e,t,n){return Math.max(t,Math.min(n,e))},a=function a(e,t,n,o){var i=n-e,r=o-t;return i*i+r*r},n=function n(e,t){return(t=t!==undefined&&!!t)&&e==2*Math.PI?2*Math.PI:e-2*Math.floor(e/(2*Math.PI))*Math.PI};this.load=function(){if(He.innerHTML="",ct&&1===ct.nodeType)He.appendChild(ct);else if(ct&&"string"==typeof ct)He.innerHTML=ct;else if(ut){var e=document.createElement("img");e.setAttribute("src",ut),e.setAttribute("alt",dt),He.appendChild(e)}else He.textContent=dt;(Oe=document.createElement("div")).style.width="100%",Oe.style.height="100%",Oe.style.position="relative",Oe.style.overflow="hidden",t()?window.THREE!==undefined?(Pe={width:0,height:0,ratio:0},ot&&!Ne.match(/^data:image\/[a-z]+;base64/)?o():d()):console.log("PhotoSphereViewer: Three.js is not loaded."):He.textContent="Canvas is not supported, update your browser!"};var r=function r(e){for(var t=0,n=0,o="";-1!=(t=e.indexOf("<x:xmpmeta",n))&&-1!=(n=e.indexOf("</x:xmpmeta>",t));)if(-1!=(o=e.substring(t,n)).indexOf("GPano:"))return o;return""},l=function l(e,t){var n=e.indexOf("GPano:"+t)+t.length+8,o=e.indexOf('"',n);return-1==o&&(n=e.indexOf("GPano:"+t)+t.length+7,o=e.indexOf("<",n)),e.substring(n,o)},o=function o(){var t=null;if(window.XMLHttpRequest)t=new XMLHttpRequest;else{if(!window.ActiveXObject)return void(He.textContent="XHR is not supported, update your browser!");try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}}t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=r(t.responseText);if(!e.length)return void d();rt={full_width:parseInt(l(e,"FullPanoWidthPixels")),full_height:parseInt(l(e,"FullPanoHeightPixels")),cropped_width:parseInt(l(e,"CroppedAreaImageWidthPixels")),cropped_height:parseInt(l(e,"CroppedAreaImageHeightPixels")),cropped_x:parseInt(l(e,"CroppedAreaLeftPixels")),cropped_y:parseInt(l(e,"CroppedAreaTopPixels"))},lt=!0,d()}},t.open("GET",Ne,!0),t.send(null)},d=function d(){var c=new Image;c.onload=function(){var e={full_width:c.width,full_height:c.height,cropped_width:c.width,cropped_height:c.height,cropped_x:null,cropped_y:null};if(360!=at.horizontal_fov||180!=at.vertical_fov){if(rt.cropped_width=e.cropped_width,rt.cropped_height=e.cropped_height,rt.full_width=e.full_width,rt.full_height=e.full_height,360!=at.horizontal_fov){var t=at.horizontal_fov/360;rt.full_width=rt.cropped_width/t}if(180!=at.vertical_fov){var n=at.vertical_fov/180;rt.full_height=rt.cropped_height/n}}else{for(var o in rt)null===rt[o]&&e[o]!==undefined&&(rt[o]=e[o]);if(lt){if(rt.cropped_width!=e.cropped_width){var i=e.cropped_width/rt.cropped_width;rt.cropped_width=e.cropped_width,rt.full_width*=i,rt.cropped_x*=i}if(rt.cropped_height!=e.cropped_height){var r=e.cropped_height/rt.cropped_height;rt.cropped_height=e.cropped_height,rt.full_height*=r,rt.cropped_y*=r}}}null===rt.cropped_x&&(rt.cropped_x=(rt.full_width-rt.cropped_width)/2),null===rt.cropped_y&&(rt.cropped_y=(rt.full_height-rt.cropped_height)/2);var s=2048;if(h()){var a=document.createElement("canvas").getContext("webgl");s=a.getParameter(a.MAX_TEXTURE_SIZE)}var l=Math.min(rt.full_width,s),d=l/rt.full_width;rt.full_width=l,rt.cropped_width*=d,rt.cropped_x*=d,c.width=rt.cropped_width,rt.full_height*=d,rt.cropped_height*=d,rt.cropped_y*=d,c.height=rt.cropped_height;var u=document.createElement("canvas");u.width=rt.full_width,u.height=rt.full_height,u.getContext("2d").drawImage(c,rt.cropped_x,rt.cropped_y,rt.cropped_width,rt.cropped_height),p(u.toDataURL("image/jpeg"))},it&&!Ne.match(/^data:image\/[a-z]+;base64/)&&c.setAttribute("crossOrigin","anonymous"),c.src=Ne},p=function p(e){var t=new THREE.Texture;t.minFilter=THREE.LinearFilter;var n=new THREE.ImageLoader,o=function o(e){t.needsUpdate=!0,t.image=e,u(t)};n.load(e,o)},u=function u(e){Ae.width!==undefined&&(He.style.width=Ae.width.css),Ae.height!==undefined&&(He.style.height=Ae.height.css),x(),(Xe=h()?new THREE.WebGLRenderer:new THREE.CanvasRenderer).setSize(Pe.width,Pe.height),We=new THREE.Scene,($e=new THREE.PerspectiveCamera(se,Pe.ratio,1,300)).position.set(0,0,0),We.add($e);var t=new THREE.SphereGeometry(200,me,ge),n=new THREE.MeshBasicMaterial({map:e,overdraw:!0}),o=new THREE.Mesh(t,n);if(o.scale.x=-1,We.add(o),(De=document.createElement("div")).style.position="absolute",De.style.zIndex=0,Oe.appendChild(De),Se&&(Ee.setClass(Te),Ee.setStyle(Re),Ee.create(),Oe.appendChild(Ee.getBar())),null!==ht){var i=document.createElement("img");i.onload=function(){i.style.display="block",i.style.position="absolute",i.style[ht.position.x]="5px",i.style[ht.position.y]="5px","bottom"==ht.position.y&&Se&&(i.style.bottom=Ee.getBar().offsetHeight+5+"px"),ht.size!==undefined&&(i.style.width=ht.size.width,i.style.height=ht.size.height),Oe.appendChild(i)},i.src=ht.image}s(window,"resize",x),Me&&(s(De,"mousedown",M),s(document,"mousemove",H),s(De,"mousemove",Y),s(document,"mouseup",B),s(De,"touchstart",P),s(document,"touchend",B),s(document,"touchmove",A),Ie&&(s(De,"mousewheel",X),s(De,"DOMMouseScroll",X)),pt.addAction("fullscreen-mode",S)),s(document,"fullscreenchange",V),s(document,"mozfullscreenchange",V),s(document,"webkitfullscreenchange",V),s(document,"MSFullscreenChange",V),tt.addListener(N),He.innerHTML="",He.appendChild(Oe);var r=Xe.domElement;r.style.display="block",De.appendChild(r),c(),0<ye&&W(ye),m(),Z("ready")},c=function c(){var e=new THREE.Vector3;e.setX(Math.cos(he)*Math.sin(pe)),e.setY(Math.sin(he)),e.setZ(Math.cos(he)*Math.cos(pe)),$e.lookAt(e),null!==Ve?Ve.render(We,$e):Xe.render(We,$e)},f=function f(){(Ve=new THREE.StereoEffect(Xe)).eyeSeparation=Be,Ve.setSize(Pe.width,Pe.height),O(),q(),Ee.mustBeHidden(),c(),Z("stereo-effect",!0)},g=function g(){Ve=null,Xe.setSize(Pe.width,Pe.height),Ee.mustBeHidden(!1),c(),Z("stereo-effect",!1)};this.toggleStereo=function(){null!==Ve?g():f()};var m=function m(){!1!==we&&(Ze=setTimeout(v,we))},y=function y(){he-=(he-ke)*Ce,pe+=xe;var e=!0;ce||(pe=i(pe,J,Q))!=J&&pe!=Q||(_e?xe*=-1:(b(),e=!1)),pe=n(pe,!0),Z("position-updated",{longitude:pe,latitude:he}),c(),e&&(Ke=setTimeout(y,be))},v=function v(){y(),Z("autorotate",Qe=!0)},b=function b(){clearTimeout(Ze),Ze=null,clearTimeout(Ke),Ke=null,Z("autorotate",Qe=!1)},w=function w(){et&&(et=!1,v())};this.toggleAutorotate=function(){clearTimeout(Ze),Ke?b():v()};var x=function x(){var e=C(He),t=e.detached,n=e.rendered;!1!==t||!1!==n||"px"!=Ae.width.unit||"px"!=Ae.height.unit?He.clientWidth==Pe.width&&He.clientHeight==Pe.height||k({width:He.clientWidth,height:He.clientHeight}):k({width:parseFloat(Ae.width.css)||0,height:parseFloat(Ae.height.css)||0})},_=function _(e,t,n){return(window.getComputedStyle(e,n||null)||{display:"none"})[t]},C=function C(e){if(!document.documentElement.contains(e))return{detached:!0,rendered:!1};for(var t=e;t!==document;){if("none"===_(t,"display"))return{detached:!1,rendered:!1};t=t.parentNode}return{detached:!1,rendered:!0}};this.fitToContainer=function(){x()};var k=function k(e){Pe.width=e.width!==undefined?parseInt(e.width):Pe.width,Pe.height=e.height!==undefined?parseInt(e.height):Pe.height,Pe.ratio=Pe.width/Pe.height,$e&&($e.aspect=Pe.ratio,$e.updateProjectionMatrix()),Xe&&(Xe.setSize(Pe.width,Pe.height),c()),Ve&&(Ve.setSize(Pe.width,Pe.height),c())};this.getPosition=function(){return{longitude:pe,latitude:he}},this.getPositionInDegrees=function(){return{longitude:180*pe/Math.PI,latitude:180*he/Math.PI}};var z=function z(e,t){var n=U(e);ce||(n=i(n,J,Q));var o=U(t);o>Math.PI&&(o-=2*Math.PI),o=i(o,le,ae),Z("position-updated",{longitude:pe=n,latitude:he=o}),c()};this.moveTo=function(e,t){z(e,t)};var E=function E(e,t){e=U(e),t=U(t),z(pe+e,he+t)};this.rotate=function(e,t){E(e,t)};var S=function S(e){(e?window.addEventListener:window.removeEventListener)("keydown",R)},T=function T(e){if(e.key)return/^Arrow/.test(e.key)?e.key:"Arrow"+e.key;if(e.keyCode||e.which){var t=e.keyCode?e.keyCode:e.which,n={38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",37:"ArrowLeft"};if(n[t]!==undefined)return n[t]}return""},R=function R(e){var t=0,n=0;switch(T(e)){case"ArrowUp":n=ie;break;case"ArrowRight":t=-oe;break;case"ArrowDown":n=-ie;break;case"ArrowLeft":t=oe}E(t,n)},M=function M(e){I(parseInt(e.clientX),parseInt(e.clientY))},P=function P(e){if(1==e.touches.length){var t=e.touches[0];t.target.parentNode==De&&I(parseInt(t.clientX),parseInt(t.clientY))}else 2==e.touches.length&&(B(),e.touches[0].target.parentNode==De&&e.touches[1].target.parentNode==De&&F(a(e.touches[0].clientX,e.touches[0].clientY,e.touches[1].clientX,e.touches[1].clientY)));Y()},I=function I(e,t){Ge=e,Ye=t,clearTimeout(Je),!(Je=null)===Qe&&(et=!0),b(),qe=!0},F=function F(e){Ue=e,je=!0},B=function B(e){je=qe=!1,Je=setTimeout(w,500)},H=function H(e){L(parseInt(e.clientX),parseInt(e.clientY))},A=function A(e){if(1==e.touches.length&&qe){var t=e.touches[0];t.target.parentNode==De&&(e.preventDefault(),L(parseInt(t.clientX),parseInt(t.clientY)))}else if(2==e.touches.length&&e.touches[0].target.parentNode==De&&e.touches[1].target.parentNode==De&&je){e.preventDefault();var n=a(e.touches[0].clientX,e.touches[0].clientY,e.touches[1].clientX,e.touches[1].clientY),o=n-Ue;if(0!==o){var i=o/Math.abs(o);W(ye+i*Fe),Ue=n}}},L=function L(e,t){qe&&(ee?(pe+=(e-Ge)/Pe.height*ve*Math.PI/180,he+=(t-Ye)/Pe.height*ve*Math.PI/180):(pe+=(e-Ge)*te,he+=(t-Ye)*ne),Ge=e,Ye=t,ce||(pe=i(pe,J,Q)),pe=n(pe,!0),he=i(he,le,ae),Z("position-updated",{longitude:pe,latitude:he}),c())},O=function O(){tt.start(),b(),Z("device-orientation",!0)},D=function D(){tt.stop(),Z("device-orientation",!1)};this.toggleDeviceOrientation=function(){tt.isEventAttached()?D():O()};var N=function N(e){pe=i(e.longitude,J,Q),he=i(e.latitude,le,ae),Z("position-updated",{longitude:pe,latitude:he}),c()},X=function X(e){e.preventDefault(),e.stopPropagation();var t=e.detail?-e.detail:e.wheelDelta;if(0!==t){var n=parseInt(t/Math.abs(t));W(ye+n*Fe)}};this.mouseWheel=function(e){X(e)};var W=function W(e){ye=i(e,0,100),ve=se+ye/100*(re-se),$e.fov=ve,$e.updateProjectionMatrix(),c(),Z("zoom-updated",ye)};this.getZoomLevel=function(){return ye},this.zoom=function(e){W(e)},this.zoomIn=function(){ye<100&&W(ye+Fe)},this.zoomOut=function(){0<ye&&W(ye-Fe)};var $=function $(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},V=function V(){document.webkitFullscreenElement||document.msFullscreenElement?(Le.width=He.style.width,Le.height=He.style.height,He.style.width="100%",He.style.height="100%",x()):(He.webkitRequestFullscreen||He.msRequestFullscreen)&&(He.style.width=Le.width,He.style.height=Le.height,x()),Z("fullscreen-mode",$())},q=function q(){He.requestFullscreen?He.requestFullscreen():He.mozRequestFullScreen?He.mozRequestFullScreen():He.webkitRequestFullscreen?He.webkitRequestFullscreen():He.msRequestFullscreen&&He.msRequestFullscreen()},G=function G(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()};this.toggleFullscreen=function(){$()?G():q()};var Y=function Y(){Se&&Ee.show()},j=function j(e){e=e.toString().trim();var t=parseFloat(e.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1")),n=e.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();n.match(/(pm|per minute)$/)&&(t/=60);var o=0;switch(n){case"rpm":case"rev per minute":case"revolutions per minute":case"rps":case"rev per second":case"revolutions per second":o=2*t*Math.PI;break;case"dpm":case"deg per minute":case"degrees per minute":case"dps":case"deg per second":case"degrees per second":o=t*Math.PI/180;break;case"rad per minute":case"radians per minute":case"rad per second":case"radians per second":o=t;break;default:m_anim=!1}return o*be/1e3},U=function U(e){e=e.toString().trim();var t=parseFloat(e.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1"));return"deg"==e.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim()&&(t*=Math.PI/180),n(t)},K=function K(e){for(var t in e)if("width"==t||"height"==t){var n=e[t].toString().trim(),o=parseFloat(n.replace(/^([0-9]+(?:\.[0-9]*)?).*$/,"$1")),i=n.replace(/^[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();"%"!=i&&(i="px"),Ae[t]={css:o+i,unit:i}}};this.addAction=function(e,t){e in nt||(nt[e]=[]),nt[e].push(t)};var Z=function Z(e,t){if(e in nt&&nt[e].length)for(var n=0,o=nt[e].length;n<o;++n)t!==undefined?nt[e][n](t):nt[e][n]()};if(e!==undefined&&e.panorama!==undefined&&e.container!==undefined){var J,Q,ee=e.smooth_user_moves===undefined||!!e.smooth_user_moves,te=e.long_offset!==undefined?U(e.long_offset):Math.PI/360,ne=e.lat_offset!==undefined?U(e.lat_offset):Math.PI/180,oe=e.keyboard_long_offset!==undefined?U(e.keyboard_long_offset):Math.PI/60,ie=e.keyboard_lat_offset!==undefined?U(e.keyboard_lat_offset):Math.PI/120,re=e.min_fov!==undefined?i(parseFloat(e.min_fov),1,179):30,se=e.max_fov!==undefined?i(parseFloat(e.max_fov),1,179):90,ae=e.tilt_up_max!==undefined?i(U(e.tilt_up_max),0,Math.PI/2):Math.PI/2,le=e.tilt_down_max!==undefined?-i(U(e.tilt_down_max),0,Math.PI/2):-Math.PI/2,de=e.min_longitude!==undefined?U(e.min_longitude):0,ue=e.max_longitude!==undefined?U(e.max_longitude):0,ce=de==ue;ce?(de=0,ue=2*Math.PI):0===ue&&(ue=2*Math.PI),Q=de<ue?(J=de,ue):(J=ue,de);var he=0,pe=J;if(e.default_position!==undefined){if(e.default_position.lat!==undefined){var fe=U(e.default_position.lat);fe>Math.PI&&(fe-=2*Math.PI),he=i(fe,le,ae)}e.default_position._long!==undefined&&(pe=i(U(e.default_position._long),J,Q))}var ge=e.segments!==undefined?parseInt(e.segments):100,me=e.rings!==undefined?parseInt(e.rings):100,ye=0;e.zoom_level!==undefined&&(ye=i(parseInt(Math.round(e.zoom_level)),0,100));var ve=se+ye/100*(re-se),be=1e3/60,we=2e3;e.time_anim!==undefined&&(we="number"==typeof e.time_anim&&0<=e.time_anim&&e.time_anim);var xe=e.anim_speed!==undefined?j(e.anim_speed):j("2rpm"),_e=!0;e.reverse_anim!==undefined&&(_e=!!e.reverse_anim);var Ce=e.vertical_anim_speed!==undefined?j(e.vertical_anim_speed):j("2rpm"),ke=0;if(e.vertical_anim_target!==undefined){var ze=U(e.vertical_anim_target);ze>Math.PI&&(ze-=2*Math.PI),ke=i(ze,le,ae)}var Ee=new PSVNavBar(this),Se=e.navbar!==undefined&&!!e.navbar,Te=e.navbar_class!==undefined?e.navbar_class:{},Re=e.navbar_style!==undefined?e.navbar_style:{},Me=e.allow_user_interactions===undefined||!!e.allow_user_interactions;Me||(Se=!1);var Pe,Ie=e.allow_scroll_to_zoom===undefined||!!e.allow_scroll_to_zoom,Fe=e.zoom_speed!==undefined?parseFloat(e.zoom_speed):1,Be=e.eyes_offset!==undefined?parseFloat(e.eyes_offset):5,He="string"==typeof e.container?document.getElementById(e.container):e.container,Ae={},Le={};e.size!==undefined&&K(e.size);var Oe,De,Ne=e.panorama,Xe=null,We=null,$e=null,Ve=null,qe=!1,Ge=0,Ye=0,je=!1,Ue=0,Ke=null,Ze=null,Je=null,Qe=!1,et=!1,tt=new Sphoords,nt={},ot=e.usexmpdata===undefined||!!e.usexmpdata,it=e.cors_anonymous===undefined||!!e.cors_anonymous,rt={full_width:null,full_height:null,cropped_width:null,cropped_height:null,cropped_x:null,cropped_y:null};if(e.pano_size!==undefined){for(var st in rt)e.pano_size[st]!==undefined&&(rt[st]=parseInt(e.pano_size[st]));ot=!1}var at={horizontal_fov:360,vertical_fov:180};if(e.captured_view!==undefined){for(var st in at)e.captured_view[st]!==undefined&&(at[st]=parseFloat(e.captured_view[st]));ot=!1}var lt=!1,dt=e.loading_msg!==undefined?e.loading_msg.toString():"Loading…",ut=e.loading_img!==undefined?e.loading_img.toString():null,ct=e.loading_html!==undefined?e.loading_html:null,ht=null;e.overlay!==undefined&&e.overlay.image!==undefined&&(ht={image:e.overlay.image,position:{x:"left",y:"bottom"}},e.overlay.position!==undefined&&(e.overlay.position.x===undefined||"left"!=e.overlay.position.x&&"right"!=e.overlay.position.x||(ht.position.x=e.overlay.position.x),e.overlay.position.y===undefined||"top"!=e.overlay.position.y&&"bottom"!=e.overlay.position.y||(ht.position.y=e.overlay.position.y)),e.overlay.size!==undefined&&(ht.size={width:e.overlay.size.width!==undefined?e.overlay.size.width:"auto",height:e.overlay.size.height!==undefined?e.overlay.size.height:"auto"}));var pt=this;e.onready!==undefined&&this.addAction("ready",e.onready),(e.autoload===undefined||!!e.autoload)&&this.load()}else console.log("PhotoSphereViewer: no value given for panorama or container")},PSVNavBar=function PSVNavBar(e){var i=function i(e,t){for(var n=0,o=t.length;n<o;++n)if(t[n]==e)return!0;return!1},n=function n(e,t){return i(e,g)&&"string"==typeof t&&("transparent"==t||!!t.match(/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/)||!!t.match(/^rgb\((1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])(,\s*(1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}\)$/)||!!t.match(/^rgba\(((1?[0-9]{1,2}|2[0-4][0-9]|25[0-5]),\s*){3}(0(\.[0-9]*)?|1)\)$/))||i(e,m)&&!isNaN(parseFloat(t))&&isFinite(t)&&0<=t},o=function o(e,t){e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(e.className+=" "+t)};this.setClass=function(e){for(var t in e)t in p&&"string"==typeof t&&(p[t]=e[t])},this.setStyle=function(e){for(var t in e)t in f&&n(t,e[t])&&(f[t]=e[t])},this.create=function(){s=document.createElement("div"),p.navbarClass?o(s,p.navbarClass):(s.style.backgroundColor=f.backgroundColor,s.style.position="absolute",s.style.zIndex=10,s.style.bottom=0,s.style.width="100%",s.style.boxSizing="content-box",s.style.transition="bottom 0.4s ease-out"),a=new PSVNavBarButton(e,"autorotate",f,p,h),s.appendChild(a.getButton()),l=new PSVNavBarButton(e,"zoom",f,p,h),s.appendChild(l.getButton()),d=new PSVNavBarButton(e,"fullscreen",f,p,h),s.appendChild(d.getButton()),Sphoords.isDeviceOrientationSupported&&(u=new PSVNavBarButton(e,"orientation",f),s.appendChild(u.getButton()),c=new PSVNavBarButton(e,"virtual-reality",f),s.appendChild(c.getButton()))},this.getBar=function(){return s};var t=function t(){y&&(clearTimeout(y),!v&&b&&(y=setTimeout(r,5e3))),v&&(s.style.bottom=0,v=!1,b&&(y=setTimeout(r,5e3)))};this.show=function(){t()};var r=function r(){v||(s.style.bottom=1-s.offsetHeight+"px",v=!0)};this.hide=function(){r()},this.isHidden=function(){return v},this.mustBeHidden=function(e){(b=e===undefined||!!e)?r():t()};var s,a,l,d,u,c,h={autorotateTips:"播放",activeAutorotateTips:"暂停",zoomMinusTips:"缩小",zoomPlusTips:"放大",fullscreenTips:"全屏",activeFullscreenTips:"退出全屏"},p={navbarClass:"",autorotateClass:"",activeAutorotateClass:"",zoomClass:"",zoomMinusClass:"",zoomRangeBgClass:"",zoomRangeClass:"",zoomValueClass:"",zoomCompleteClass:"",zoomPlusClass:"",fullscreenClass:""},f={backgroundColor:"rgba(61, 61, 61, 0.5)",buttonsColor:"rgba(255, 255, 255, 0.7)",buttonsBackgroundColor:"transparent",activeButtonsBackgroundColor:"rgba(255, 255, 255, 0.1)",buttonsHeight:20,autorotateThickness:1,zoomRangeWidth:50,zoomRangeThickness:1,zoomRangeDisk:7,fullscreenRatio:4/3,fullscreenThickness:2,gyroscopeThickness:1,virtualRealityRatio:4/3,virtualRealityBorderRadius:2},g=["backgroundColor","buttonsColor","buttonsBackgroundColor","activeButtonsBackgroundColor"],m=["buttonsHeight","autorotateThickness","zoomRangeWidth","zoomRangeThickness","zoomRangeDisk","fullscreenRatio","fullscreenThickness"],y=null,v=!1,b=!1},PSVNavBarButton=function PSVNavBarButton(M,P,I,F,B){var H=function H(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},A=function A(e,t){e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))||(e.className+=" "+t)},o=function o(e,t){if(e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},L=function L(){switch(P){case"autorotate":var e=I.buttonsHeight-2*I.autorotateThickness,t=e/10;if(W=document.createElement("div"),H(W,"click",function(){M.toggleAutorotate()}),W.title=B.autorotateTips,M.addAction("autorotate",q),F.activeAutorotateClass&&M.addAction("autorotate",V),F.autorotateClass)A(W,F.autorotateClass);else{W.style.cssFloat="left",W.style.boxSizing="inherit",W.style.padding="10px",W.style.width=I.buttonsHeight+"px",W.style.height=I.buttonsHeight+"px",W.style.backgroundColor=I.buttonsBackgroundColor,W.style.position="relative",W.style.cursor="pointer";var n=document.createElement("div");n.style.boxSizing="inherit",n.style.width=e+"px",n.style.height=e+"px",n.style.borderRadius="50%",n.style.border=I.autorotateThickness+"px solid "+I.buttonsColor,W.appendChild(n);var o=document.createElement("div");o.style.boxSizing="inherit",o.style.width=e+"px",o.style.height=t+"px",o.style.borderRadius="50%",o.style.border=I.autorotateThickness+"px solid "+I.buttonsColor,o.style.position="absolute",o.style.top="50%",o.style.marginTop=-(t/2+I.autorotateThickness)+"px",W.appendChild(o),M.addAction("autorotate",$)}break;case"zoom":W=document.createElement("div"),F.zoomClass?A(W,F.zoomClass):(W.style.cssFloat="left",W.style.boxSizing="inherit");var i=document.createElement("div");i.title=B.zoomMinusTips,H(i,"click",function(){M.zoomOut()}),F.zoomMinusClass?A(i,F.zoomMinusClass):(i.style.cssFloat="left",i.style.boxSizing="inherit",i.style.padding="10px",i.style.height=I.buttonsHeight+"px",i.style.backgroundColor=I.buttonsBackgroundColor,i.style.lineHeight=I.buttonsHeight+"px",i.style.color=I.buttonsColor,i.style.cursor="pointer",i.textContent="-"),W.appendChild(i),O=document.createElement("div"),F.zoomRangeBgClass?A(O,F.zoomRangeBgClass):(O.style.cssFloat="left",O.style.boxSizing="inherit",O.style.padding=10+(I.buttonsHeight-I.zoomRangeThickness)/2+"px 5px",O.style.backgroundColor=I.buttonsBackgroundColor,O.style.cursor="pointer"),W.appendChild(O),(D=document.createElement("div")).style.width=I.zoomRangeWidth+"px",D.style.height=I.zoomRangeThickness+"px",F.zoomRangeClass?A(D,F.zoomRangeClass):(D.style.boxSizing="inherit",D.style.backgroundColor=I.buttonsColor,D.style.position="relative"),O.appendChild(D),(N=document.createElement("div")).style.top=(I.zoomRangeThickness-I.zoomRangeDisk)/2+"px",N.style.left=-I.zoomRangeDisk/2+"px",N.style.width=I.zoomRangeDisk+"px",N.style.height=I.zoomRangeDisk+"px",F.zoomValueClass?A(N,F.zoomValueClass):(N.style.position="absolute",N.style.boxSizing="inherit",N.style.borderRadius="50%",N.style.backgroundColor=I.buttonsColor),(X=document.createElement("div")).style.width="0px",X.style.height=I.zoomRangeThickness+"px",F.zoomValueClass&&A(X,F.zoomCompleteClass),M.addAction("zoom-updated",Y),M.addAction("zoom-updated",j),H(O,"mousedown",U),H(O,"touchstart",K),H(document,"mousemove",J),H(document,"touchmove",Q),H(document,"mouseup",Z),H(document,"touchend",Z),H(O,"mousewheel",ee),H(O,"DOMMouseScroll",ee),D.appendChild(N),D.appendChild(X);var r=document.createElement("div");r.title=B.zoomPlusTips,H(r,"click",function(){M.zoomIn()}),F.zoomPlusClass?A(r,F.zoomPlusClass):(r.style.cssFloat="left",r.style.boxSizing="inherit",r.style.padding="10px",r.style.height=I.buttonsHeight+"px",r.style.backgroundColor=I.buttonsBackgroundColor,r.style.lineHeight=I.buttonsHeight+"px",r.style.color=I.buttonsColor,r.style.cursor="pointer",r.textContent="+"),W.appendChild(r);break;case"fullscreen":var s=I.buttonsHeight*I.fullscreenRatio,a=.3*I.buttonsHeight,l=(I.buttonsHeight-a)/2,d=.3*s,u=(s-d)/2-I.fullscreenThickness,c=I.buttonsHeight-2*I.fullscreenThickness;if((W=document.createElement("div")).title=B.fullscreenTips,M.addAction("fullscreen-mode",G),H(W,"click",function(e){M.toggleFullscreen()}),F.fullscreenClass)A(W,F.fullscreenClass);else{W.style.cssFloat="right",W.style.boxSizing="inherit",W.style.padding="10px",W.style.width=s+"px",W.style.height=I.buttonsHeight+"px",W.style.backgroundColor=I.buttonsBackgroundColor,W.style.cursor="pointer";var h=document.createElement("div");h.style.cssFloat="left",h.style.boxSizing="inherit",h.style.width=I.fullscreenThickness+"px",h.style.height=a+"px",h.style.borderStyle="solid",h.style.borderColor=I.buttonsColor+" transparent",h.style.borderWidth=l+"px 0",W.appendChild(h);var p=document.createElement("div");p.style.cssFloat="left",p.style.boxSizing="inherit",p.style.width=u+"px",p.style.height=c+"px",p.style.borderStyle="solid",p.style.borderColor=I.buttonsColor+" transparent",p.style.borderWidth=I.fullscreenThickness+"px 0",W.appendChild(p);var f=document.createElement("div");f.style.cssFloat="left",f.style.boxSizing="inherit",f.style.marginLeft=d+"px",f.style.width=u+"px",f.style.height=c+"px",f.style.borderStyle="solid",f.style.borderColor=I.buttonsColor+" transparent",f.style.borderWidth=I.fullscreenThickness+"px 0",W.appendChild(f);var g=document.createElement("div");g.style.cssFloat="left",g.style.boxSizing="inherit",g.style.width=I.fullscreenThickness+"px",g.style.height=a+"px",g.style.borderStyle="solid",g.style.borderColor=I.buttonsColor+" transparent",g.style.borderWidth=l+"px 0",W.appendChild(g);var m=document.createElement("div");m.style.clear="left",W.appendChild(m),M.addAction("fullscreen-mode",$)}break;case"orientation":var y=I.buttonsHeight-2*I.gyroscopeThickness,v=y-4*I.gyroscopeThickness,b=y/10;(W=document.createElement("div")).style.cssFloat="right",W.style.boxSizing="inherit",W.style.padding="10px",W.style.width=I.buttonsHeight+"px",W.style.height=I.buttonsHeight+"px",W.style.backgroundColor=I.buttonsBackgroundColor,W.style.position="relative",W.style.cursor="pointer",H(W,"click",function(){M.toggleDeviceOrientation()});var w=document.createElement("div");w.style.boxSizing="inherit",w.style.width=y+"px",w.style.height=y+"px",w.style.borderRadius="50%",w.style.border=I.gyroscopeThickness+"px solid "+I.buttonsColor,W.appendChild(w);var x=document.createElement("div");x.style.boxSizing="inherit",x.style.width=v+"px",x.style.height=b+"px",x.style.borderRadius="50%",x.style.border=I.gyroscopeThickness+"px solid "+I.buttonsColor,x.style.position="absolute",x.style.top="50%",x.style.left="50%",x.style.marginTop=-(b/2+I.gyroscopeThickness)+"px",x.style.marginLeft=-(v/2+I.gyroscopeThickness)+"px",W.appendChild(x);var _=document.createElement("div");_.style.boxSizing="inherit",_.style.width=b+"px",_.style.height=v+"px",_.style.borderRadius="50%",_.style.border=I.gyroscopeThickness+"px solid "+I.buttonsColor,_.style.position="absolute",_.style.top="50%",_.style.left="50%",_.style.marginTop=-(v/2+I.gyroscopeThickness)+"px",_.style.marginLeft=-(b/2+I.gyroscopeThickness)+"px",W.appendChild(_),M.addAction("device-orientation",$);break;case"virtual-reality":var C=I.buttonsHeight*I.virtualRealityRatio,k=C/4,z=k/2;(W=document.createElement("div")).style.cssFloat="right",W.style.position="relative",W.style.boxSizing="inherit",W.style.padding="10px",W.style.width=C+"px",W.style.height=I.buttonsHeight+"px",W.style.backgroundColor=I.buttonsBackgroundColor,W.style.cursor="pointer",H(W,"click",function(){M.toggleStereo()});var E=document.createElement("div");E.style.boxSizing="inherit",E.style.width=C+"px",E.style.height=I.buttonsHeight+"px",E.style.borderRadius=I.virtualRealityBorderRadius+"px",E.style.backgroundColor=I.buttonsColor,W.appendChild(E);var S=document.createElement("div");S.style.boxSizing="inherit",S.style.width=k+"px",S.style.height=k+"px",S.style.position="absolute",S.style.top=z+10+"px",S.style.left=z+10+"px",S.style.borderRadius="50%",S.style.backgroundColor=I.backgroundColor,W.appendChild(S);var T=document.createElement("div");T.style.boxSizing="inherit",T.style.width=k+"px",T.style.height=k+"px",T.style.position="absolute",T.style.top=z+10+"px",T.style.right=z+10+"px",T.style.borderRadius="50%",T.style.backgroundColor=I.backgroundColor,W.appendChild(T);var R=document.createElement("div");R.style.boxSizing="inherit",R.style.width=k+"px",R.style.height=I.buttonsHeight/2+"px",R.style.position="absolute",R.style.left="50%",R.style.bottom="10px",R.style.marginLeft=-k/2+"px",R.style.borderTopLeftRadius="50% 60%",R.style.borderTopRightRadius="50% 60%",R.style.backgroundColor=I.backgroundColor,W.appendChild(R),M.addAction("stereo-effect",$)}};this.getButton=function(){return W};var O,D,N,X,W,$=function $(e){W.style.backgroundColor=e?I.activeButtonsBackgroundColor:I.buttonsBackgroundColor},V=function V(e){e?A(W,F.activeAutorotateClass):o(W,F.activeAutorotateClass)},q=function q(e){W.title=e?B.activeAutorotateTips:B.autorotateTips},G=function G(e){W.title=e?B.activeFullscreenTips:B.fullscreenTips},Y=function Y(e){N.style.left=e/100*I.zoomRangeWidth-I.zoomRangeDisk/2+"px"},j=function j(e){X.style.width=e/100*I.zoomRangeWidth-I.zoomRangeDisk/2+"px"},U=function U(e){n(parseInt(e.clientX))},K=function K(e){var t=e.touches[0];t.target!=O&&t.target!=D&&t.target!=N||n(parseInt(t.clientX))},n=function n(e){r=!0,i(e)},Z=function Z(e){r=!1},J=function J(e){i(parseInt(e.clientX))},Q=function Q(e){var t=e.touches[0];t.target!=O&&t.target!=D&&t.target!=N||(e.preventDefault(),i(parseInt(t.clientX)))},i=function i(e){if(r){var t=(e-D.getBoundingClientRect().left)/I.zoomRangeWidth*100;M.zoom(t)}},ee=function ee(e){M.mouseWheel(e)},r=!1;L()},Sphoords=function Sphoords(){var t=function t(){var e=navigator.userAgent;return/Gecko\/[0-9.]+/.test(e)?"Gecko":/Chrome\/[0-9.]+/.test(e)?"Blink":/AppleWebKit\/[0-9.]+/.test(e)?"WebKit":/Trident\/[0-9.]+/.test(e)?"Trident":/Opera\/[0-9.]+/.test(e)?"Presto":"Gecko"},o=function o(e){return e-360*Math.floor(e/360)};this.start=function(){return Sphoords.isDeviceOrientationSupported?(window.addEventListener("deviceorientation",i,!1),e=!0):(console.log("Device Orientation API not supported"),!1)},this.stop=function(){e&&(window.removeEventListener("deviceorientation",i,!1),e=!1)},this.toggle=function(){e?this.stop():this.start()},this.isEventAttached=function(){return e};var i=function i(e){var t=0,n=0;switch(c=Sphoords.getScreenOrientation()){case"portrait-primary":t=e.alpha+e.gamma,n=e.beta-90;break;case"landscape-primary":if(t=e.alpha+e.beta-90,n=-e.gamma-90,90<Math.abs(e.beta))switch(h){case"Blink":n+=180;break;case"Gecko":default:n=-n}"WebKit"===h&&window.orientation&&(n<0&&(n=-1*(n+180)),180<=t?t-=180:t+=180);break;case"landscape-secondary":if(t=e.alpha-e.beta+90,n=e.gamma-90,90<Math.abs(e.beta))switch(h){case"Blink":n+=180;break;case"Gecko":default:n=-n}"WebKit"===h&&window.orientation&&(n<0&&(n=-1*(n+180)),180<=t?t-=180:t+=180);break;case"portrait-secondary":t=e.alpha-e.gamma,n=180-(e.beta-90),n=270-e.beta}180<=(n=o(n))&&(n-=360),s=o(t),a=Math.max(-90,Math.min(90,n)),l=s*u,d=a*u,r()};this.getCoordinates=function(){return{longitude:l,latitude:d}},this.getCoordinatesInDegrees=function(){return{longitude:s,latitude:a}},this.getScreenOrientation=function(){return c},this.addListener=function(e){n.push(e)};var r=function r(){if(n.length)for(var e=0,t=n.length;e<t;++e)n[e]({longitude:l,latitude:d})},e=!1,s=0,a=0,l=0,d=0,u=Math.PI/180,c=Sphoords.getScreenOrientation(),h=t(),n=[]};Sphoords.getScreenOrientation=function(){var e=null;if(screen.orientation)e=screen.orientation;else if(screen.mozOrientation)e=screen.mozOrientation;else if(screen.msOrientation)e=screen.msOrientation;else if(window.orientation||0===window.orientation)switch(window.orientation){case 0:e="portrait-primary";break;case 180:e="portrait-secondary";break;case-90:e="landscape-primary";break;case 90:e="landscape-secondary"}return null!==e&&"object"==_typeof(e)?e.type:e},Sphoords.isDeviceOrientationSupported=!1,function(){if(window.DeviceOrientationEvent&&null!==Sphoords.getScreenOrientation())(function t(e){null!==e&&null!==e.alpha&&(Sphoords.isDeviceOrientationSupported=!0,window.removeEventListener("deviceorientation",t))})}();